<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kakao Chat Demo</title>

<style>

body{
margin:0;
background:#b2c7da;
font-family:system-ui;
}

.app{
max-width:430px;
height:100vh;
margin:auto;
background:#b2c7da;
display:flex;
flex-direction:column;
overflow:hidden;
}

/* LOGIN */

.login{
flex:1;
display:flex;
flex-direction:column;
justify-content:center;
padding:25px;
animation:fadeIn .4s ease;
}

@keyframes fadeIn{
from{opacity:0; transform:translateY(20px);}
to{opacity:1; transform:translateY(0);}
}

.login input{
padding:12px;
margin-bottom:10px;
border:none;
border-radius:12px;
}

.login button{
padding:12px;
border:none;
border-radius:12px;
background:#fee500;
font-weight:bold;
}

/* HEADER */

.header{
padding:12px;
background:#a5c4dd;
text-align:center;
font-weight:bold;
}

/* PROFILE BAR */

.profile{
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
padding:8px;
background:#dfeaf5;
}

.profileLeft{
display:flex;
align-items:center;
gap:10px;
}

.profile img{
width:40px;
height:40px;
border-radius:50%;
border:2px solid #fee500;
object-fit:cover;
}

.adminTag{
color:red;
font-size:12px;
font-weight:bold;
}

.settingBtn{
font-size:12px;
background:#fee500;
border:none;
border-radius:10px;
padding:5px 10px;
}

/* NOTICE */

.notice{
background:#333;
color:white;
text-align:center;
padding:6px;
font-size:13px;
}

/* CHAT */

.chatbox{
flex:1;
padding:10px;
overflow-y:auto;
display:flex;
flex-direction:column;
}

.msg{
max-width:75%;
padding:10px;
border-radius:15px;
margin:5px 0;
font-size:14px;
word-break:break-word;
}

.me{
background:#fee500;
align-self:flex-end;
border-bottom-right-radius:0;
}

.you{
background:white;
align-self:flex-start;
border-bottom-left-radius:0;
display:flex;
gap:7px;
}

.you img{
width:32px;
height:32px;
border-radius:50%;
object-fit:cover;
}

.name{
font-size:11px;
opacity:.6;
margin-bottom:3px;
}

.time{
font-size:10px;
opacity:.6;
text-align:right;
margin-top:3px;
}

/* INPUT */

.inputbar{
display:flex;
padding:7px;
background:#eee;
}

.inputbar textarea{
flex:1;
border:none;
border-radius:20px;
padding:10px;
resize:none;
height:40px;
}

.inputbar button{
margin-left:5px;
border:none;
border-radius:50%;
background:#fee500;
padding:10px 15px;
}

</style>
</head>

<body>

<div class="app">

<!-- LOGIN -->

<div id="loginBox" class="login">
<h2>CHAT LOGIN</h2>
<input id="username" placeholder="ÎãâÎÑ§ÏûÑ">
<input type="file" id="profileInput">
<button id="loginBtn">ENTER</button>
</div>

<!-- CHAT -->

<div id="chatWrap" style="display:none">

<div class="header">CHAT ROOM</div>

<div class="profile">
<div class="profileLeft">
<img id="profileImg">
<div>
<span id="profileName"></span>
<span id="adminBadge" class="adminTag"></span>
</div>
</div>

<button class="settingBtn" onclick="editProfile()">ÌîÑÎ°úÌïÑ</button>
</div>

<div id="notice" class="notice">üì¢ Í≥µÏßÄ : ÌôòÏòÅÌï©ÎãàÎã§</div>

<div id="chatbox" class="chatbox"></div>

<div class="inputbar">
<textarea id="msg" placeholder="Î©îÏãúÏßÄ ÏûÖÎ†•"></textarea>
<button id="sendBtn">‚û§</button>
</div>

</div>

</div>

<script>

// ---------- DATA ----------

let user = localStorage.getItem("user") || "";
let profile = localStorage.getItem("profile") || "";
let chatData = JSON.parse(localStorage.getItem("chat")) || [];
let isAdmin = false;

// ---------- DOM ----------

const loginBox = document.getElementById("loginBox");
const chatWrap = document.getElementById("chatWrap");

const usernameInput = document.getElementById("username");
const profileInput = document.getElementById("profileInput");

const loginBtn = document.getElementById("loginBtn");

const chatbox = document.getElementById("chatbox");
const msgInput = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");

const profileName = document.getElementById("profileName");
const profileImg = document.getElementById("profileImg");
const adminBadge = document.getElementById("adminBadge");
const notice = document.getElementById("notice");

// ---------- AUTO LOGIN ----------

if(user){
 openChat();
}

// ---------- LOGIN ----------

function login(){

 const name = usernameInput.value.trim();
 if(name===""){
  alert("ÎãâÎÑ§ÏûÑ ÏûÖÎ†•Ìï¥Ï§ò");
  return;
 }

 user = name;
 localStorage.setItem("user",user);

 if(profileInput.files[0]){
  const reader = new FileReader();
  reader.onload = ()=>{
   profile = reader.result;
   localStorage.setItem("profile",profile);
   openChat();
  };
  reader.readAsDataURL(profileInput.files[0]);
 }else{
  openChat();
 }

}

// ---------- PROFILE EDIT ----------

function editProfile(){

 const newName = prompt("ÎãâÎÑ§ÏûÑ Î≥ÄÍ≤Ω",user);
 if(newName){
  user = newName;
  localStorage.setItem("user",user);
  profileName.innerText = user;
 }

}

// ---------- OPEN CHAT ----------

function openChat(){

 loginBox.style.display="none";
 chatWrap.style.display="block";

 profileName.innerText = user;

 if(profile){
  profileImg.src = profile;
 }else{
  profileImg.src = "https://cdn-icons-png.flaticon.com/512/847/847969.png";
 }

 if(user==="admin"){
  isAdmin=true;
  adminBadge.innerText=" (ADMIN)";
 }

 const savedNotice = localStorage.getItem("notice");
 if(savedNotice){
  notice.innerText="üì¢ Í≥µÏßÄ : "+savedNotice;
 }

 loadChat();
}

// ---------- SEND ----------

function send(){

 const text = msgInput.value.trim();
 if(text==="") return;

 if(isAdmin && text.startsWith("/Í≥µÏßÄ ")){
  const noticeText = text.replace("/Í≥µÏßÄ ","");
  localStorage.setItem("notice",noticeText);
  notice.innerText="üì¢ Í≥µÏßÄ : "+noticeText;
  msgInput.value="";
  return;
 }

 chatData.push({
  name:user,
  profile:profile,
  msg:text,
  time:new Date().toLocaleTimeString()
 });

 localStorage.setItem("chat",JSON.stringify(chatData));
 msgInput.value="";
 loadChat();
}

// ---------- LOAD CHAT ----------

function loadChat(){

 chatbox.innerHTML="";

 chatData.forEach(data=>{

  if(data.name === user){

   const div = document.createElement("div");
   div.className="msg me";

   div.innerHTML=`
    ${data.msg.replace(/\n/g,"<br>")}
    <div class="time">${data.time}</div>
   `;

   chatbox.appendChild(div);

  }else{

   const div = document.createElement("div");
   div.className="msg you";

   div.innerHTML=`
    <img src="${data.profile || 'https://cdn-icons-png.flaticon.com/512/847/847969.png'}">
    <div>
     <div class="name">${data.name}</div>
     ${data.msg.replace(/\n/g,"<br>")}
     <div class="time">${data.time}</div>
    </div>
   `;

   chatbox.appendChild(div);

  }

 });

 chatbox.scrollTop=chatbox.scrollHeight;
}

// ---------- EVENTS ----------

loginBtn.onclick = login;

usernameInput.addEventListener("keydown",e=>{
 if(e.key==="Enter") login();
});

sendBtn.onclick = send;

msgInput.addEventListener("keydown",e=>{
 if(e.key==="Enter" && !e.shiftKey){
  e.preventDefault();
  send();
 }
});

</script>

</body>
</html>


